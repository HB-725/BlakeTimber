{% extends "inventory/HomePage.html" %}
{% load static %}

{% block content %}
<main class="flex-1 w-full px-4 pt-4">
  <div class="mx-auto w-full max-w-md rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-200">
    <div class="mb-4 flex items-start justify-between gap-3">
      <div>
        <h1 class="text-lg font-bold text-slate-900">Add Category</h1>
        {% if parent_category %}
        <p class="text-xs text-slate-500">Parent: {{ parent_category.name }}</p>
        {% endif %}
      </div>
      <a href="{{ back_url }}" class="text-slate-400 hover:text-slate-600" aria-label="Close">
        <span class="material-symbols-outlined text-[20px]">close</span>
      </a>
    </div>

    {% if form.non_field_errors %}
    <div class="mb-3 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700">
      {{ form.non_field_errors|striptags }}
    </div>
    {% endif %}

    <form method="post" class="space-y-4" enctype="multipart/form-data">
      {% csrf_token %}

      <div>
        <label class="text-xs font-semibold uppercase tracking-wider text-slate-500">Name <span class="text-red-500">*</span></label>
        {{ form.name }}
        {% if form.name.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.name.errors|striptags }}</p>
        {% endif %}
      </div>

      <div data-image-preview-container>
        <label class="text-xs font-semibold uppercase tracking-wider text-slate-500">Image Upload</label>
        {{ form.image_file }}
        {% if form.image_file.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.image_file.errors|striptags }}</p>
        {% endif %}
        <p class="mt-1 text-[11px] text-slate-400">JPG, PNG, WEBP, or GIF.</p>
        <img data-image-preview class="mt-3 hidden h-24 w-24 rounded-lg border border-slate-200 object-cover" alt="Preview" />
      </div>

      <div class="text-center text-[11px] font-semibold uppercase tracking-wider text-slate-400">or</div>

      <div>
        <label class="text-xs font-semibold uppercase tracking-wider text-slate-500">Image URL (optional)</label>
        {{ form.image_url }}
        {% if form.image_url.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.image_url.errors|striptags }}</p>
        {% endif %}
      </div>

      {% if not form.parent.is_hidden %}
      <div>
        <label class="text-xs font-semibold uppercase tracking-wider text-slate-500">Parent Category</label>
        {{ form.parent }}
        {% if form.parent.errors %}
        <p class="mt-1 text-xs text-red-600">{{ form.parent.errors|striptags }}</p>
        {% endif %}
      </div>
      {% else %}
      {{ form.parent }}
      {% endif %}

      <button type="submit"
        class="w-full rounded-xl bg-primary px-4 py-3 text-sm font-bold uppercase tracking-wider text-white shadow-lg shadow-primary/20 hover:bg-primary/90 transition">
        Create Category
      </button>
    </form>
  </div>
</main>
<script src="{% static 'inventory/image_preview.js' %}"></script>
{% endblock %}
